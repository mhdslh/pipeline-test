name: demo

on:
  workflow_dispatch:
    inputs:

      num-retries:
        description: "number of retries"
        type: string
        default: "1"
        required: true

jobs:
  try:
    runs-on: ubuntu-latest
    steps:
    - name: "checkout"
      uses: actions/checkout@v4

    - name: "check script"
      shell: bash
      run: |
        #!/bin/bash
        echo "========> ${{ inputs.num-retries }}"
        num_retries=${{ inputs.num-retries }}
        max_try=(($num_retries+1))
        set +e
        echo "======================================="
        n=0
        while (( $n < $max_try )); do
            echo "loop $n"
            ./script.sh $n && break
            ((n++))
            sleep 1
        done
        echo "here"
        if (( n == $max_try )); then
            echo "Command failed after $max_try attempts."
            exit 1
        fi
        echo "======================================="